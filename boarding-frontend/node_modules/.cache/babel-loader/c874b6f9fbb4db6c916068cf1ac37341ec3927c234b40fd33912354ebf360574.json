{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { addMember, updateMember, removeMember } from '../redux/memberSlice';\nexport function useNotifications() {\n  _s();\n  const dispatch = useDispatch();\n  const token = localStorage.getItem('access');\n  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\n  const WS_BASE = API_BASE.replace('http', 'ws').replace('/api', '');\n  useEffect(() => {\n    if (!token) return;\n    const ws = new WebSocket(`${WS_BASE}/ws/notifications/`);\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n    };\n    ws.onmessage = event => {\n      try {\n        const payload = JSON.parse(event.data);\n        const {\n          model,\n          action,\n          data\n        } = payload;\n        if (model === 'member') {\n          if (action === 'created') {\n            dispatch(addMember(data));\n          } else if (action === 'updated') {\n            dispatch(updateMember(data));\n          } else if (action === 'deleted') {\n            dispatch(removeMember(data.id));\n          }\n        }\n        // Additional handlers for schedule, payment, repair can be added here\n      } catch (err) {\n        console.error('Error parsing WebSocket message:', err);\n      }\n    };\n    ws.onerror = err => {\n      console.error('WebSocket error:', err);\n    };\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.close();\n      }\n    };\n  }, [token, dispatch]);\n}\n_s(useNotifications, \"rAh3tY+Iv6hWC9AI4Dm+rCbkwNE=\", false, function () {\n  return [useDispatch];\n});","map":{"version":3,"names":["useEffect","useDispatch","addMember","updateMember","removeMember","useNotifications","_s","dispatch","token","localStorage","getItem","API_BASE","process","env","REACT_APP_API_BASE","WS_BASE","replace","ws","WebSocket","onopen","console","log","onmessage","event","payload","JSON","parse","data","model","action","id","err","error","onerror","readyState","OPEN","close"],"sources":["C:/Users/www/Desktop/MY BOARDING/boarding-frontend/src/hooks/useNotifications.js"],"sourcesContent":["import { useEffect } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { addMember, updateMember, removeMember } from '../redux/memberSlice'\r\n\r\nexport function useNotifications() {\r\n  const dispatch = useDispatch()\r\n  const token = localStorage.getItem('access')\r\n  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api'\r\n  const WS_BASE = API_BASE.replace('http', 'ws').replace('/api', '')\r\n\r\n  useEffect(() => {\r\n    if (!token) return\r\n\r\n    const ws = new WebSocket(`${WS_BASE}/ws/notifications/`)\r\n\r\n    ws.onopen = () => {\r\n      console.log('WebSocket connected')\r\n    }\r\n\r\n    ws.onmessage = (event) => {\r\n      try {\r\n        const payload = JSON.parse(event.data)\r\n        const { model, action, data } = payload\r\n\r\n        if (model === 'member') {\r\n          if (action === 'created') {\r\n            dispatch(addMember(data))\r\n          } else if (action === 'updated') {\r\n            dispatch(updateMember(data))\r\n          } else if (action === 'deleted') {\r\n            dispatch(removeMember(data.id))\r\n          }\r\n        }\r\n        // Additional handlers for schedule, payment, repair can be added here\r\n      } catch (err) {\r\n        console.error('Error parsing WebSocket message:', err)\r\n      }\r\n    }\r\n\r\n    ws.onerror = (err) => {\r\n      console.error('WebSocket error:', err)\r\n    }\r\n\r\n    return () => {\r\n      if (ws.readyState === WebSocket.OPEN) {\r\n        ws.close()\r\n      }\r\n    }\r\n  }, [token, dispatch])\r\n}\r\n"],"mappings":";AAAA,SAASA,SAAS,QAAQ,OAAO;AACjC,SAASC,WAAW,QAAQ,aAAa;AACzC,SAASC,SAAS,EAAEC,YAAY,EAAEC,YAAY,QAAQ,sBAAsB;AAE5E,OAAO,SAASC,gBAAgBA,CAAA,EAAG;EAAAC,EAAA;EACjC,MAAMC,QAAQ,GAAGN,WAAW,CAAC,CAAC;EAC9B,MAAMO,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;EAC5C,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACC,kBAAkB,IAAI,2BAA2B;EAC9E,MAAMC,OAAO,GAAGJ,QAAQ,CAACK,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAACA,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;EAElEhB,SAAS,CAAC,MAAM;IACd,IAAI,CAACQ,KAAK,EAAE;IAEZ,MAAMS,EAAE,GAAG,IAAIC,SAAS,CAAC,GAAGH,OAAO,oBAAoB,CAAC;IAExDE,EAAE,CAACE,MAAM,GAAG,MAAM;MAChBC,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;IACpC,CAAC;IAEDJ,EAAE,CAACK,SAAS,GAAIC,KAAK,IAAK;MACxB,IAAI;QACF,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;QACtC,MAAM;UAAEC,KAAK;UAAEC,MAAM;UAAEF;QAAK,CAAC,GAAGH,OAAO;QAEvC,IAAII,KAAK,KAAK,QAAQ,EAAE;UACtB,IAAIC,MAAM,KAAK,SAAS,EAAE;YACxBtB,QAAQ,CAACL,SAAS,CAACyB,IAAI,CAAC,CAAC;UAC3B,CAAC,MAAM,IAAIE,MAAM,KAAK,SAAS,EAAE;YAC/BtB,QAAQ,CAACJ,YAAY,CAACwB,IAAI,CAAC,CAAC;UAC9B,CAAC,MAAM,IAAIE,MAAM,KAAK,SAAS,EAAE;YAC/BtB,QAAQ,CAACH,YAAY,CAACuB,IAAI,CAACG,EAAE,CAAC,CAAC;UACjC;QACF;QACA;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZX,OAAO,CAACY,KAAK,CAAC,kCAAkC,EAAED,GAAG,CAAC;MACxD;IACF,CAAC;IAEDd,EAAE,CAACgB,OAAO,GAAIF,GAAG,IAAK;MACpBX,OAAO,CAACY,KAAK,CAAC,kBAAkB,EAAED,GAAG,CAAC;IACxC,CAAC;IAED,OAAO,MAAM;MACX,IAAId,EAAE,CAACiB,UAAU,KAAKhB,SAAS,CAACiB,IAAI,EAAE;QACpClB,EAAE,CAACmB,KAAK,CAAC,CAAC;MACZ;IACF,CAAC;EACH,CAAC,EAAE,CAAC5B,KAAK,EAAED,QAAQ,CAAC,CAAC;AACvB;AAACD,EAAA,CA7CeD,gBAAgB;EAAA,QACbJ,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}