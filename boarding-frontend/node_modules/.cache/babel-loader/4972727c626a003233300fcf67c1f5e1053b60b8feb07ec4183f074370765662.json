{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { addMember, updateMember, removeMember } from '../redux/memberSlice';\nimport { addSchedule, updateSchedule, removeSchedule } from '../redux/scheduleSlice';\nimport { addPayment, updatePayment, removePayment } from '../redux/paymentSlice';\nimport { addBill, updateBill, removeBill } from '../redux/billSlice';\nimport { addRepair, updateRepair, removeRepair } from '../redux/repairSlice';\nexport function useNotifications() {\n  _s();\n  const dispatch = useDispatch();\n  const token = localStorage.getItem('access');\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\n  const WS_BASE = API_BASE.replace('http', 'ws').replace('/api', '');\n  useEffect(() => {\n    if (!token) {\n      console.log('[WS] No token, skipping WebSocket connection');\n      return;\n    }\n    const connectWebSocket = () => {\n      try {\n        console.log('[WS] Attempting to connect to:', `${WS_BASE}/ws/notifications/`);\n        const ws = new WebSocket(`${WS_BASE}/ws/notifications/`);\n        ws.onopen = () => {\n          console.log('[WS] Connected successfully');\n          // Clear any reconnect timeout on successful connection\n          if (reconnectTimeoutRef.current) {\n            clearTimeout(reconnectTimeoutRef.current);\n            reconnectTimeoutRef.current = null;\n          }\n        };\n        ws.onmessage = event => {\n          try {\n            const payload = JSON.parse(event.data);\n            console.log('[WS] Message received:', payload);\n            const {\n              model,\n              action,\n              data\n            } = payload;\n            if (model === 'member') {\n              if (action === 'created') dispatch(addMember(data));else if (action === 'updated') dispatch(updateMember(data));else if (action === 'deleted') dispatch(removeMember(data.id));\n            } else if (model === 'schedule') {\n              if (action === 'created') dispatch(addSchedule(data));else if (action === 'updated') dispatch(updateSchedule(data));else if (action === 'deleted') dispatch(removeSchedule(data.id));\n            } else if (model === 'payment') {\n              if (action === 'created') dispatch(addPayment(data));else if (action === 'updated') dispatch(updatePayment(data));else if (action === 'deleted') dispatch(removePayment(data.id));\n            } else if (model === 'bill') {\n              if (action === 'created') dispatch(addBill(data));else if (action === 'updated') dispatch(updateBill(data));else if (action === 'deleted') dispatch(removeBill(data.id));\n            } else if (model === 'repair') {\n              if (action === 'created') dispatch(addRepair(data));else if (action === 'updated') dispatch(updateRepair(data));else if (action === 'deleted') dispatch(removeRepair(data.id));\n            }\n          } catch (err) {\n            console.error('[WS] Error parsing message:', err);\n          }\n        };\n        ws.onerror = err => {\n          console.error('[WS] Connection error:', err);\n        };\n        ws.onclose = () => {\n          console.log('[WS] Connection closed');\n          // Try to reconnect after 3 seconds\n          reconnectTimeoutRef.current = setTimeout(() => {\n            console.log('[WS] Attempting to reconnect...');\n            connectWebSocket();\n          }, 3000);\n        };\n        wsRef.current = ws;\n      } catch (err) {\n        console.error('[WS] Failed to create WebSocket:', err);\n      }\n    };\n    connectWebSocket();\n\n    // Cleanup function\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n        wsRef.current.close();\n      }\n    };\n  }, [token, dispatch]);\n}\n_s(useNotifications, \"QhdokTUl54g7iBQ6Ay5QaH5Ul8c=\", false, function () {\n  return [useDispatch];\n});","map":{"version":3,"names":["useEffect","useRef","useDispatch","addMember","updateMember","removeMember","addSchedule","updateSchedule","removeSchedule","addPayment","updatePayment","removePayment","addBill","updateBill","removeBill","addRepair","updateRepair","removeRepair","useNotifications","_s","dispatch","token","localStorage","getItem","wsRef","reconnectTimeoutRef","API_BASE","process","env","REACT_APP_API_BASE","WS_BASE","replace","console","log","connectWebSocket","ws","WebSocket","onopen","current","clearTimeout","onmessage","event","payload","JSON","parse","data","model","action","id","err","error","onerror","onclose","setTimeout","readyState","OPEN","close"],"sources":["C:/Users/www/Desktop/MY BOARDING/boarding-frontend/src/hooks/useNotifications.js"],"sourcesContent":["import { useEffect, useRef } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { addMember, updateMember, removeMember } from '../redux/memberSlice'\r\nimport { addSchedule, updateSchedule, removeSchedule } from '../redux/scheduleSlice'\r\nimport { addPayment, updatePayment, removePayment } from '../redux/paymentSlice'\r\nimport { addBill, updateBill, removeBill } from '../redux/billSlice'\r\nimport { addRepair, updateRepair, removeRepair } from '../redux/repairSlice'\r\n\r\nexport function useNotifications() {\r\n  const dispatch = useDispatch()\r\n  const token = localStorage.getItem('access')\r\n  const wsRef = useRef(null)\r\n  const reconnectTimeoutRef = useRef(null)\r\n  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api'\r\n  const WS_BASE = API_BASE.replace('http', 'ws').replace('/api', '')\r\n\r\n  useEffect(() => {\r\n    if (!token) {\r\n      console.log('[WS] No token, skipping WebSocket connection')\r\n      return\r\n    }\r\n\r\n    const connectWebSocket = () => {\r\n      try {\r\n        console.log('[WS] Attempting to connect to:', `${WS_BASE}/ws/notifications/`)\r\n        const ws = new WebSocket(`${WS_BASE}/ws/notifications/`)\r\n\r\n        ws.onopen = () => {\r\n          console.log('[WS] Connected successfully')\r\n          // Clear any reconnect timeout on successful connection\r\n          if (reconnectTimeoutRef.current) {\r\n            clearTimeout(reconnectTimeoutRef.current)\r\n            reconnectTimeoutRef.current = null\r\n          }\r\n        }\r\n\r\n        ws.onmessage = (event) => {\r\n          try {\r\n            const payload = JSON.parse(event.data)\r\n            console.log('[WS] Message received:', payload)\r\n            const { model, action, data } = payload\r\n\r\n            if (model === 'member') {\r\n              if (action === 'created') dispatch(addMember(data))\r\n              else if (action === 'updated') dispatch(updateMember(data))\r\n              else if (action === 'deleted') dispatch(removeMember(data.id))\r\n            } else if (model === 'schedule') {\r\n              if (action === 'created') dispatch(addSchedule(data))\r\n              else if (action === 'updated') dispatch(updateSchedule(data))\r\n              else if (action === 'deleted') dispatch(removeSchedule(data.id))\r\n            } else if (model === 'payment') {\r\n              if (action === 'created') dispatch(addPayment(data))\r\n              else if (action === 'updated') dispatch(updatePayment(data))\r\n              else if (action === 'deleted') dispatch(removePayment(data.id))\r\n            } else if (model === 'bill') {\r\n              if (action === 'created') dispatch(addBill(data))\r\n              else if (action === 'updated') dispatch(updateBill(data))\r\n              else if (action === 'deleted') dispatch(removeBill(data.id))\r\n            } else if (model === 'repair') {\r\n              if (action === 'created') dispatch(addRepair(data))\r\n              else if (action === 'updated') dispatch(updateRepair(data))\r\n              else if (action === 'deleted') dispatch(removeRepair(data.id))\r\n            }\r\n          } catch (err) {\r\n            console.error('[WS] Error parsing message:', err)\r\n          }\r\n        }\r\n\r\n        ws.onerror = (err) => {\r\n          console.error('[WS] Connection error:', err)\r\n        }\r\n\r\n        ws.onclose = () => {\r\n          console.log('[WS] Connection closed')\r\n          // Try to reconnect after 3 seconds\r\n          reconnectTimeoutRef.current = setTimeout(() => {\r\n            console.log('[WS] Attempting to reconnect...')\r\n            connectWebSocket()\r\n          }, 3000)\r\n        }\r\n\r\n        wsRef.current = ws\r\n      } catch (err) {\r\n        console.error('[WS] Failed to create WebSocket:', err)\r\n      }\r\n    }\r\n\r\n    connectWebSocket()\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      if (reconnectTimeoutRef.current) {\r\n        clearTimeout(reconnectTimeoutRef.current)\r\n      }\r\n      if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        wsRef.current.close()\r\n      }\r\n    }\r\n  }, [token, dispatch])\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}