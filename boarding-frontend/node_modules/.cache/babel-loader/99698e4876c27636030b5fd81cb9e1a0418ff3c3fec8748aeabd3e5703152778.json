{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { addMember, updateMember, removeMember } from '../redux/memberSlice';\nimport { addSchedule, updateSchedule, removeSchedule } from '../redux/scheduleSlice';\nimport { addPayment, updatePayment, removePayment } from '../redux/paymentSlice';\nimport { addBill, updateBill, removeBill } from '../redux/billSlice';\nimport { addRepair, updateRepair, removeRepair } from '../redux/repairSlice';\nexport function useNotifications() {\n  _s();\n  const dispatch = useDispatch();\n  const token = localStorage.getItem('access');\n  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\n  const WS_BASE = API_BASE.replace('http', 'ws').replace('/api', '');\n  useEffect(() => {\n    if (!token) return;\n    const ws = new WebSocket(`${WS_BASE}/ws/notifications/`);\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n    };\n    ws.onmessage = event => {\n      try {\n        const payload = JSON.parse(event.data);\n        const {\n          model,\n          action,\n          data\n        } = payload;\n        if (model === 'member') {\n          if (action === 'created') dispatch(addMember(data));else if (action === 'updated') dispatch(updateMember(data));else if (action === 'deleted') dispatch(removeMember(data.id));\n        } else if (model === 'schedule') {\n          if (action === 'created') dispatch(addSchedule(data));else if (action === 'updated') dispatch(updateSchedule(data));else if (action === 'deleted') dispatch(removeSchedule(data.id));\n        } else if (model === 'payment') {\n          if (action === 'created') dispatch(addPayment(data));else if (action === 'updated') dispatch(updatePayment(data));else if (action === 'deleted') dispatch(removePayment(data.id));\n        } else if (model === 'bill') {\n          if (action === 'created') dispatch(addBill(data));else if (action === 'updated') dispatch(updateBill(data));else if (action === 'deleted') dispatch(removeBill(data.id));\n        } else if (model === 'repair') {\n          if (action === 'created') dispatch(addRepair(data));else if (action === 'updated') dispatch(updateRepair(data));else if (action === 'deleted') dispatch(removeRepair(data.id));\n        }\n      } catch (err) {\n        console.error('Error parsing WebSocket message:', err);\n      }\n    };\n    ws.onerror = err => {\n      console.error('WebSocket error:', err);\n    };\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.close();\n      }\n    };\n  }, [token, dispatch]);\n}\n_s(useNotifications, \"rAh3tY+Iv6hWC9AI4Dm+rCbkwNE=\", false, function () {\n  return [useDispatch];\n});","map":{"version":3,"names":["useEffect","useDispatch","addMember","updateMember","removeMember","addSchedule","updateSchedule","removeSchedule","addPayment","updatePayment","removePayment","addBill","updateBill","removeBill","addRepair","updateRepair","removeRepair","useNotifications","_s","dispatch","token","localStorage","getItem","API_BASE","process","env","REACT_APP_API_BASE","WS_BASE","replace","ws","WebSocket","onopen","console","log","onmessage","event","payload","JSON","parse","data","model","action","id","err","error","onerror","readyState","OPEN","close"],"sources":["C:/Users/www/Desktop/MY BOARDING/boarding-frontend/src/hooks/useNotifications.js"],"sourcesContent":["import { useEffect } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { addMember, updateMember, removeMember } from '../redux/memberSlice'\r\nimport { addSchedule, updateSchedule, removeSchedule } from '../redux/scheduleSlice'\r\nimport { addPayment, updatePayment, removePayment } from '../redux/paymentSlice'\r\nimport { addBill, updateBill, removeBill } from '../redux/billSlice'\r\nimport { addRepair, updateRepair, removeRepair } from '../redux/repairSlice'\r\n\r\nexport function useNotifications() {\r\n  const dispatch = useDispatch()\r\n  const token = localStorage.getItem('access')\r\n  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api'\r\n  const WS_BASE = API_BASE.replace('http', 'ws').replace('/api', '')\r\n\r\n  useEffect(() => {\r\n    if (!token) return\r\n\r\n    const ws = new WebSocket(`${WS_BASE}/ws/notifications/`)\r\n\r\n    ws.onopen = () => {\r\n      console.log('WebSocket connected')\r\n    }\r\n\r\n    ws.onmessage = (event) => {\r\n      try {\r\n        const payload = JSON.parse(event.data)\r\n        const { model, action, data } = payload\r\n\r\n        if (model === 'member') {\r\n          if (action === 'created') dispatch(addMember(data))\r\n          else if (action === 'updated') dispatch(updateMember(data))\r\n          else if (action === 'deleted') dispatch(removeMember(data.id))\r\n        } else if (model === 'schedule') {\r\n          if (action === 'created') dispatch(addSchedule(data))\r\n          else if (action === 'updated') dispatch(updateSchedule(data))\r\n          else if (action === 'deleted') dispatch(removeSchedule(data.id))\r\n        } else if (model === 'payment') {\r\n          if (action === 'created') dispatch(addPayment(data))\r\n          else if (action === 'updated') dispatch(updatePayment(data))\r\n          else if (action === 'deleted') dispatch(removePayment(data.id))\r\n        } else if (model === 'bill') {\r\n          if (action === 'created') dispatch(addBill(data))\r\n          else if (action === 'updated') dispatch(updateBill(data))\r\n          else if (action === 'deleted') dispatch(removeBill(data.id))\r\n        } else if (model === 'repair') {\r\n          if (action === 'created') dispatch(addRepair(data))\r\n          else if (action === 'updated') dispatch(updateRepair(data))\r\n          else if (action === 'deleted') dispatch(removeRepair(data.id))\r\n        }\r\n      } catch (err) {\r\n        console.error('Error parsing WebSocket message:', err)\r\n      }\r\n    }\r\n\r\n    ws.onerror = (err) => {\r\n      console.error('WebSocket error:', err)\r\n    }\r\n\r\n    return () => {\r\n      if (ws.readyState === WebSocket.OPEN) {\r\n        ws.close()\r\n      }\r\n    }\r\n  }, [token, dispatch])\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}